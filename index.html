<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Resmi DKM Baitul Fattah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tambahkan plugin typography untuk styling teks artikel di modal -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .active-nav {
            color: #16a34a; /* green-600 */
            font-weight: 600;
        }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://firebasestorage.googleapis.com/v0/b/dkm-baitul-fattah.firebasestorage.app/o/WhatsApp%20Image%202025-09-09%20at%2014.11.11.jpeg?alt=media&token=8c4a8f1c-5b0e-4f4e-857b-da54d94aceef');
            background-size: cover;
            background-position: center;
        }
        .section-title {
            @apply text-3xl font-bold text-gray-800 mb-2 text-center;
        }
        .section-subtitle {
            @apply text-center text-gray-500 mb-8 max-w-2xl mx-auto;
        }
        .fade-in {
            animation: fadeInAnimation 1s ease-in-out forwards;
            opacity: 0;
        }
        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Style untuk Modal .modal-hidden dihapus karena kita akan pakai class 'hidden' dari Tailwind */
    </style>
</head>
<body class="bg-gray-50 text-gray-700">

    <!-- Header / Navigation -->
    <header id="header" class="bg-white/80 backdrop-blur-md shadow-md fixed w-full top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="#beranda" class="flex items-center space-x-2">
                        <img class="h-10 w-auto" src="https://firebasestorage.googleapis.com/v0/b/dkm-baitul-fattah.firebasestorage.app/o/Logo_Masjid.jpg?alt=media&token=9f7143f5-12f9-40b9-be93-2e539eec1a17" alt="Logo DKM Baitul Fattah">
                        <span class="hidden sm:block text-xl font-bold text-green-700">DKM Baitul Fattah</span>
                    </a>
                </div>
                <div class="hidden md:block">
                    <nav class="ml-10 flex items-baseline space-x-4">
                        <a href="#beranda" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Beranda</a>
                        <a href="#profil" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Profil</a>
                        <a href="#pengurus" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Pengurus</a>
                        <a href="#jadwal" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Jadwal</a>
                        <a href="#berita" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Berita</a>
                        <a href="#keuangan" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Keuangan</a>
                        <a href="#kontak" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-green-600">Kontak</a>
                    </nav>
                </div>
                <div class="hidden md:block">
                    <a href="#donasi" class="bg-green-600 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-green-700 transition-colors">Donasi Sekarang</a>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button id="mobile-menu-button" type="button" class="bg-white p-2 inline-flex items-center justify-center rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Buka menu utama</span>
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div class="hidden md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#beranda" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Beranda</a>
                <a href="#profil" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Profil</a>
                <a href="#pengurus" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Pengurus</a>
                <a href="#jadwal" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Jadwal</a>
                <a href="#berita" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Berita</a>
                <a href="#keuangan" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Keuangan</a>
                 <a href="#kontak" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50">Kontak</a>
                <a href="#donasi" class="block w-full text-left bg-green-600 text-white mt-2 px-3 py-2 rounded-md text-base font-medium hover:bg-green-700">Donasi Sekarang</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Section Beranda / Hero -->
        <section id="beranda" class="hero-bg h-screen flex items-center justify-center text-white">
            <div class="text-center px-4">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-lg fade-in">Selamat Datang di Masjid Baitul Fattah</h1>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto drop-shadow-md fade-in" style="animation-delay: 0.2s;">Pusat Ibadah, Pendidikan, dan Pemberdayaan Umat.</p>
                
                <!-- Jadwal Shalat Widget -->
                <div class="bg-white/10 backdrop-blur-sm p-6 rounded-2xl max-w-4xl mx-auto fade-in" style="animation-delay: 0.4s;">
                    <h3 class="text-xl font-semibold mb-4" id="prayer-date">Memuat jadwal shalat...</h3>
                    <div id="prayer-times-loader" class="text-center">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                    </div>
                    <div id="prayer-times-container" class="hidden grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4 text-center">
                        <!-- Waktu Shalat akan diisi oleh JavaScript -->
                        <div class="prayer-item"><p class="font-semibold text-lg">Subuh</p><p id="subuh-time">-:-</p></div>
                        <div class="prayer-item"><p class="font-semibold text-lg">Syuruq</p><p id="syuruq-time">-:-</p></div>
                        <div class="prayer-item"><p class="font-semibold text-lg">Dzuhur</p><p id="dzuhur-time">-:-</p></div>
                        <div class="prayer-item"><p class="font-semibold text-lg">Ashar</p><p id="ashar-time">-:-</p></div>
                        <div class="prayer-item"><p class="font-semibold text-lg">Maghrib</p><p id="maghrib-time">-:-</p></div>
                        <div class="prayer-item"><p class="font-semibold text-lg">Isya</p><p id="isya-time">-:-</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Profil -->
        <section id="profil" class="py-20 scroll-mt-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="section-title">Profil Masjid Baitul Fattah</h2>
                <p class="section-subtitle">Mengenal lebih dekat rumah ibadah kita, dari sejarah hingga visi dan misi untuk umat.</p>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="rounded-lg overflow-hidden shadow-lg">
                        <img src="https://firebasestorage.googleapis.com/v0/b/dkm-baitul-fattah.firebasestorage.app/o/WhatsApp%20Image%202025-09-09%20at%2014.11.11.jpeg?alt=media" alt="Foto Masjid Baitul Fattah" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Sejarah & Visi Misi</h3>
                        <p class="mb-4">Masjid Baitul Fattah didirikan pada tahun 1995 atas prakarsa tokoh masyarakat dan swadaya jamaah. Sejak awal, masjid ini dirancang tidak hanya sebagai tempat shalat, tetapi juga sebagai pusat kegiatan keislaman yang ramah bagi semua kalangan usia.</p>
                        <p class="font-semibold text-gray-600 mb-2">Visi Kami:</p>
                        <p class="mb-4 pl-4 border-l-4 border-green-500">"Menjadi pusat peradaban Islam yang memakmurkan dan dimakmurkan oleh jamaah, serta menebar rahmat bagi semesta alam."</p>
                         <p class="font-semibold text-gray-600 mb-2">Misi Kami:</p>
                        <ul class="list-disc list-inside space-y-2">
                            <li>Menyelenggarakan ibadah yang khusyuk dan nyaman.</li>
                            <li>Memberikan ruang yg spesial bagi para pemuda.</li>
			    <li>Mengembangkan program pendidikan Al-Qur'an dan keislaman.</li>
                            <li>Menjadi motor penggerak kegiatan sosial dan pemberdayaan ekonomi umat.</li>
                            <li>Membangun ukhuwah islamiyah di antara jamaah dan masyarakat.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Pengurus -->
        <section id="pengurus" class="py-20 bg-white scroll-mt-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="section-title">Struktur Pengurus DKM</h2>
                <p class="section-subtitle">Mengenal tim DKM Baitul Fattah yang berkhidmat untuk melayani jamaah periode 2025-2028.</p>
                
                <!-- Tombol untuk membuka modal -->
                <div class="text-center mb-10">
                    <button id="open-pengurus-modal-btn" class="bg-green-600 text-white px-6 py-2 rounded-full text-sm font-semibold hover:bg-green-700 transition-colors shadow-md">
                        <i class="fas fa-list-ul mr-2"></i>Lihat Daftar Lengkap Pengurus
                    </button>
                </div>
                
                <div id="pengurus-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-6xl mx-auto">
                    <!-- Konten Pengurus akan dimuat dari Firebase -->
                    <div class="text-center col-span-1 md:col-span-2 lg:col-span-4">
                        <i class="fas fa-spinner fa-spin fa-2x text-gray-400"></i>
                        <p class="mt-2 text-gray-500">Memuat data pengurus...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Jadwal -->
        <section id="jadwal" class="py-20 bg-green-50/50 scroll-mt-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="section-title">Agenda & Jadwal Kegiatan</h2>
                <p class="section-subtitle">Ikuti berbagai kegiatan ilmu dan ibadah untuk meningkatkan keimanan dan wawasan kita bersama.</p>
                
                <div class="max-w-4xl mx-auto">
                     <div class="mb-6 border-b border-gray-200">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <button class="tab-btn active text-green-600 border-green-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="kajian-tab">
                                Pengajian Rutin
                            </button>
                            <button class="tab-btn text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="jumat-tab">
                                Khotib Jum'at
                            </button>
                        </nav>
                    </div>

                    <div id="kajian-tab" class="tab-content">
                        <div id="kajian-container" class="space-y-4">
                           <!-- Konten Pengajian Rutin akan dimuat dari Firebase -->
                           <div class="text-center py-4">
                                <i class="fas fa-spinner fa-spin fa-2x text-gray-400"></i>
                                <p class="mt-2 text-gray-500">Memuat jadwal pengajian...</p>
                            </div>
                        </div>
                    </div>

                    <div id="jumat-tab" class="tab-content hidden">
                         <div id="jumat-container" class="space-y-3">
                           <!-- Konten Khotib Jum'at akan dimuat dari Firebase -->
                           <div class="text-center py-4">
                                <i class="fas fa-spinner fa-spin fa-2x text-gray-400"></i>
                                <p class="mt-2 text-gray-500">Memuat jadwal khotib...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Section Berita -->
        <section id="berita" class="py-20 scroll-mt-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="section-title">Berita & Artikel Terkini</h2>
                <p class="section-subtitle">Informasi seputar kegiatan masjid dan artikel-artikel keislaman yang bermanfaat.</p>
                <div id="berita-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Konten berita akan dimuat dari Firebase di sini -->
                    <div class="text-center col-span-1 md:col-span-2 lg:col-span-3">
                        <i class="fas fa-spinner fa-spin fa-2x text-gray-400"></i>
                        <p class="mt-2 text-gray-500">Memuat berita...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Keuangan & Donasi -->
        <section id="keuangan" class="py-20 bg-gray-900 text-white scroll-mt-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <!-- Laporan Keuangan -->
                    <div>
                        <h2 class="text-3xl font-bold mb-2">Transparansi Dana Umat</h2>
                        <p class="text-gray-300 mb-6">Sebagai bentuk amanah, kami menyajikan laporan keuangan masjid secara berkala. Dana yang Bapak/Ibu titipkan kami kelola untuk kemakmuran masjid dan umat.</p>
                        <div class="bg-gray-800 p-6 rounded-xl">
                            <h4 class="font-semibold text-lg mb-4">Laporan Kas Masjid - Oktober 2025</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <p class="text-gray-300">Pemasukan Bulan Ini</p>
                                    <p class="font-semibold text-green-400 text-xl">Rp 15.250.000</p>
                                </div>
                                <div class="flex justify-between items-center">
                                    <p class="text-gray-300">Pengeluaran Bulan Ini</p>
                                    <p class="font-semibold text-red-400 text-xl">Rp 8.700.000</p>
                                </div>
                                <hr class="border-gray-600 my-3">
                                <div class="flex justify-between items-center">
                                    <p class="text-gray-300 font-bold">Saldo Akhir</p>
                                    <p class="font-bold text-2xl">Rp 65.550.000</p>
                                </div>
                            </div>
                            <a href="#" class="text-green-400 mt-4 inline-block hover:underline">Lihat Laporan Detail &rarr;</a>
                        </div>
                    </div>
                    <!-- Donasi -->
                    <div id="donasi" class="bg-white text-gray-800 p-8 rounded-2xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-3">Salurkan Infaq & Shadaqah Terbaik Anda</h3>
                        <p class="mb-6">Mari ikut berpartisipasi dalam program-program kebaikan Masjid Baitul Fattah. Setiap rupiah yang Anda donasikan akan menjadi amal jariyah yang pahalanya terus mengalir.</p>
                        <div class="mb-4">
                            <p class="font-semibold">Scan QRIS untuk Donasi Operasional & Pembangunan:</p>
                            <!-- Mengganti info rekening bank dengan gambar QRIS -->
                            <div class="bg-white p-4 rounded-lg mt-2 text-center">
                                <!-- Ukuran diubah: w-full max-w-xs (sekitar 320px) menjadi w-32 (128px) -->
                                <img src="https://firebasestorage.googleapis.com/v0/b/dkm-baitul-fattah.firebasestorage.app/o/qris%20mbf.png?alt=media" alt="QRIS Donasi DKM Baitul Fattah" class="w-32 mx-auto rounded-lg shadow-md" onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden');">
                                <!-- Fallback jika gambar gagal dimuat -->
                                <p class="hidden text-red-500 text-sm mt-2">Gagal memuat gambar QRIS.</p>
                            </div>
                        </div>
                        <a href="https://wa.me/62 81387454259?text=Assalamualaikum,%20saya%20ingin%20konfirmasi%20donasi%20untuk%20Masjid%20Baitul%20Fattah." target="_blank" class="w-full bg-green-600 text-white text-center py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center space-x-2">
                            <i class="fab fa-whatsapp"></i>
                            <span>Konfirmasi via WhatsApp</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="kontak" class="bg-gray-800 text-gray-300 pt-16 pb-8 scroll-mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h4 class="font-semibold text-white text-lg mb-4">DKM Baitul Fattah</h4>
                    <p class="text-sm">Jl. Lapangan Tembak Marinir No.2 RT 07 RW 01 kelurahan Cilandak Timur, kec Pasar Minggu, Jakarta Selatan 12560.</p>
                    <p class="text-sm mt-2">Email: info@baitulfattah.org</p>
                    <p class="text-sm">Telp: +62 851-7689-1354</p>
                </div>
                <div>
                    <h4 class="font-semibold text-white text-lg mb-4">Tautan Cepat</h4>
                    <ul class="text-sm space-y-2">
                        <li><a href="#profil" class="hover:text-white">Tentang Kami</a></li>
                        <li><a href="#pengurus" class="hover:text-white">Struktur Pengurus</a></li>
                        <li><a href="#jadwal" class="hover:text-white">Jadwal Kegiatan</a></li>
                        <li><a href="#berita" class="hover:text-white">Berita Umat</a></li>
                        <li><a href="#donasi" class="hover:text-white">Program Donasi</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-white text-lg mb-4">Temukan Kami</h4>
                    <div class="w-full h-40 bg-gray-600 rounded-lg">
                        <!-- Placeholder for Google Maps embed -->
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!m12!1m3!1d253801.47253281137!2d106.65152489216106!3d-6.309888553702273!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f1fdc181439b%3A0xa3a60648846be24!2sMasjid%20Jami&#39;%20Baitul%20Fattah!5e0!3m2!1sid!2sid!4v1761096806435!5m2!1sid!2sid" class="w-full h-full rounded-lg" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-6 text-center text-sm">
                <p>&copy; 2025 DKM Baitul Fattah. Seluruh Hak Cipta Dilindungi.</p>
            </div>
        </div>
    </footer>
    
    <!-- Tombol Back to Top -->
    <button id="back-to-top" class="hidden fixed bottom-5 right-5 bg-green-600 text-white w-12 h-12 rounded-full shadow-lg hover:bg-green-700 transition-colors focus:outline-none">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Modal Pengurus -->
    <!-- Mengganti 'modal-hidden' dengan 'hidden' (class bawaan Tailwind) -->
    <div id="pengurus-modal-container" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[60] p-4 transition-opacity duration-300">
        <!-- Overlay -->
        <div id="pengurus-modal-overlay" class="absolute inset-0"></div>
        
        <!-- Modal Panel -->
        <div id="pengurus-modal" class="bg-white rounded-lg shadow-xl w-full max-w-lg relative z-10 mx-auto">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800">Daftar Lengkap Pengurus DKM</h3>
                <button id="close-pengurus-modal" class="text-gray-400 hover:text-gray-600 text-3xl leading-none font-bold">&times;</button>
            </div>
            
            <!-- Modal Body -->
            <div id="pengurus-modal-content" class="p-6 max-h-[70vh] overflow-y-auto">
                <!-- Konten teks akan diisi oleh JavaScript -->
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin fa-lg text-gray-400"></i>
                    <p class="mt-2 text-gray-500">Memuat data...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Berita (BARU) -->
    <div id="berita-modal-container" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[60] p-4 transition-opacity duration-300">
        <!-- Overlay -->
        <div id="berita-modal-overlay" class="absolute inset-0"></div>
        
        <!-- Modal Panel -->
        <div id="berita-modal-panel" class="bg-white rounded-lg shadow-xl w-full max-w-2xl relative z-10 mx-auto">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-200">
                <h3 id="berita-modal-title" class="text-xl font-semibold text-gray-800">Judul Berita</h3>
                <button id="close-berita-modal" class="text-gray-400 hover:text-gray-600 text-3xl leading-none font-bold">&times;</button>
            </div>
            
            <!-- Modal Body -->
            <div id="berita-modal-content-container" class="p-6 max-h-[70vh] overflow-y-auto">
                <!-- Loader -->
                <div id="berita-modal-loader" class="text-center">
                    <i class="fas fa-spinner fa-spin fa-lg text-gray-400"></i>
                    <p class="mt-2 text-gray-500">Memuat berita...</p>
                </div>
                <!-- Konten (hidden by default) -->
                <div id="berita-modal-content" class="hidden">
                    <img id="berita-modal-img" src="" alt="Gambar Berita" class="w-full h-64 object-cover rounded-lg mb-4">
                    <p id="berita-modal-date" class="text-sm text-gray-500 mb-2"></p>
                    <!-- 'prose' class dihapus, diganti dengan text-justify dan space-y-4 (untuk jarak paragraf) -->
                    <div id="berita-modal-text" class="max-w-none text-gray-700 text-justify space-y-4"></div>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, Timestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyAjxdJttqFC6ZC3kQylAdGb_0Cgw-iPlOU",
            authDomain: "dkm-baitul-fattah.firebaseapp.com",
            projectId: "dkm-baitul-fattah",
            storageBucket: "dkm-baitul-fattah.appspot.com",
            messagingSenderId: "404244659817",
            appId: "1:404244659817:web:5ad17300c009d5ae09acf8"
        };

        // Inisialisasi Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let cachedBeritaData = null; // Tambahkan cache untuk berita

        // --- Helper function baru untuk memotong teks ---
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) {
                return text;
            }
            // Cari spasi terakhir sebelum batas maxLength untuk menghindari pemotongan kata
            const lastSpace = text.lastIndexOf(' ', maxLength);
            if (lastSpace > maxLength / 2) { // Hanya potong di spasi jika masuk akal
                return text.substring(0, lastSpace) + '...';
            }
            // Jika tidak ada spasi yang baik, potong paksa
            return text.substring(0, maxLength) + '...';
        }

        // --- Fungsi untuk mengambil dan menampilkan berita dari Firestore ---
        async function renderBerita() {
            const beritaContainer = document.getElementById('berita-container');
            if (!beritaContainer) return;

            cachedBeritaData = []; // Inisialisasi cache

            try {
                const querySnapshot = await getDocs(collection(db, "berita"));
                beritaContainer.innerHTML = ''; // Hapus loader

                if (querySnapshot.empty) {
                    beritaContainer.innerHTML = `<p class="text-center col-span-1 md:col-span-2 lg:col-span-3">Belum ada berita yang dipublikasikan.</p>`;
                    cachedBeritaData = []; // Set cache ke array kosong
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const berita = doc.data();
                    
                    // Simpan data lengkap ke cache
                    cachedBeritaData.push({ id: doc.id, ...berita });

                    // Konversi timestamp Firestore ke tanggal yang bisa dibaca
                    const beritaDate = berita.tanggal instanceof Timestamp 
                        ? berita.tanggal.toDate().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })
                        : 'Tanggal tidak valid';

                    // --- Perubahan di sini: Panggil fungsi truncateText ---
                    const kutipanSingkat = truncateText(berita.kutipan, 100); // Batasi 100 karakter

                    const beritaCardHTML = `
                        <div class="bg-white rounded-lg shadow-md overflow-hidden group">
                            <img src="${berita.gambarUrl || 'https://placehold.co/600x400/34d399/14532d?text=Gambar+Berita'}" alt="${berita.judul}" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300">
                            <div class="p-6">
                                <p class="text-sm text-gray-500 mb-2">${beritaDate}</p>
                                <h3 class="font-semibold text-lg mb-2 text-gray-800">${berita.judul}</h3>
                                <!-- Gunakan kutipanSingkat di sini -->
                                <p class="text-sm mb-4">${kutipanSingkat || ''}</p>
                                <!-- Ganti <a> dengan <button> dan tambahkan data-id -->
                                <button data-id="${doc.id}" class="open-berita-modal-btn text-green-600 font-semibold hover:underline focus:outline-none">Baca Selengkapnya &rarr;</button>
                            </div>
                        </div>
                    `;
                    beritaContainer.innerHTML += beritaCardHTML;
                });
            } catch (error) {
                console.error("Error fetching news from Firestore: ", error);
                beritaContainer.innerHTML = `<p class="text-center text-red-500 col-span-1 md:col-span-2 lg:col-span-3">Gagal memuat berita. Silakan periksa koneksi internet Anda.</p>`;
                cachedBeritaData = null; // Set cache ke null jika error
            }
        }

        // --- Fungsi BARU untuk merender konten modal berita ---
        function renderBeritaModal(id) {
            const modalTitle = document.getElementById('berita-modal-title');
            const modalImg = document.getElementById('berita-modal-img');
            const modalDate = document.getElementById('berita-modal-date');
            const modalText = document.getElementById('berita-modal-text');
            const modalLoader = document.getElementById('berita-modal-loader');
            const modalContent = document.getElementById('berita-modal-content');
            
            // Tampilkan loader, sembunyikan konten
            modalLoader.classList.remove('hidden');
            modalContent.classList.add('hidden');

            if (!cachedBeritaData) {
                modalLoader.innerHTML = '<p class="text-center text-red-500">Data berita belum dimuat. Coba lagi nanti.</p>';
                return;
            }

            const newsItem = cachedBeritaData.find(item => item.id === id);

            if (!newsItem) {
                modalLoader.innerHTML = '<p class="text-center text-red-500">Berita tidak ditemukan.</p>';
                return;
            }

            // Isi konten modal
            modalTitle.textContent = newsItem.judul;
            
            if (newsItem.gambarUrl) {
                modalImg.src = newsItem.gambarUrl;
                modalImg.alt = `Gambar ${newsItem.judul}`;
                modalImg.classList.remove('hidden');
            } else {
                modalImg.classList.add('hidden'); // Sembunyikan jika tidak ada gambar
            }
            
            modalDate.textContent = newsItem.tanggal instanceof Timestamp 
                ? newsItem.tanggal.toDate().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })
                : 'Tanggal tidak valid';

            
            // --- LOGIKA BARU UNTUK FORMAT PARAGRAF & JUSTIFY ---

            // Ambil konten mentah
            const rawContent = newsItem.isi_lengkap || newsItem.kutipan || 'Konten tidak tersedia.';
            
            // Cek jika konten sepertinya *bukan* HTML (tidak mengandung tag <p> atau <div>)
            // Ini adalah deteksi sederhana, jika tidak ada tag HTML, kita anggap plain text
            const isPlainText = !/<\/?[a-z][\s\S]*>/i.test(rawContent);
            
            let formattedContent;

            if (isPlainText) {
                // Jika ini plain text, ubah \n menjadi paragraf <p> agar 'space-y-4' berfungsi
                formattedContent = rawContent
                    .split(/\n\s*\n/) // Pisahkan berdasarkan baris kosong (paragraf baru)
                    .map(para => para.trim()) // Hapus spasi
                    .filter(para => para.length > 0) // Hapus baris kosong
                    .map(para => {
                        // Ubah sisa newline tunggal (jika ada) di dalam paragraf menjadi <br>
                        const lines = para.split('\n').join('<br>');
                        return `<p>${lines}</p>`; // Bungkus dengan tag <p>
                    })
                    .join(''); // Gabungkan semua paragraf
            } else {
                // Jika ini sudah HTML (misal dari Rich Text Editor), biarkan apa adanya
                formattedContent = rawContent;
            }
            
            modalText.innerHTML = formattedContent;
            // --- AKHIR LOGIKA BARU ---


            // Sembunyikan loader, tampilkan konten
            modalLoader.classList.add('hidden');
            modalContent.classList.remove('hidden');
        }


        // --- Fungsi untuk mengambil dan menampilkan Jadwal Kajian dari Firestore ---
        async function renderJadwalKajian() {
            const kajianContainer = document.getElementById('kajian-container');
            if (!kajianContainer) return;

            try {
                const querySnapshot = await getDocs(collection(db, "jadwal_kajian"));
                kajianContainer.innerHTML = ''; // Hapus loader

                if (querySnapshot.empty) {
                    kajianContainer.innerHTML = `<p class="text-center py-4">Jadwal pengajian rutin belum tersedia.</p>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const kajian = doc.data();
                    const kajianCardHTML = `
                        <div class="bg-white p-5 rounded-lg shadow-sm flex items-center space-x-4">
                            <div class="bg-green-100 text-green-700 w-16 h-16 rounded-lg flex flex-col items-center justify-center text-center">
                                <span class="font-bold text-lg">${kajian.hari.toUpperCase()}</span>
                                <span class="text-xs">${kajian.waktu}</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">${kajian.judul}</h3>
                                <p class="text-sm text-gray-500">Bersama: ${kajian.pemateri}</p>
                            </div>
                        </div>
                    `;
                    kajianContainer.innerHTML += kajianCardHTML;
                });
            } catch (error) {
                console.error("Error fetching schedule from Firestore: ", error);
                kajianContainer.innerHTML = `<p class="text-center text-red-500 py-4">Gagal memuat jadwal pengajian.</p>`;
            }
        }

        // --- Fungsi untuk mengambil dan menampilkan Jadwal Khotib Jum'at dari Firestore ---
        async function renderJadwalJumat() {
            const jumatContainer = document.getElementById('jumat-container');
            if (!jumatContainer) return;

            try {
                const querySnapshot = await getDocs(collection(db, "jadwal_jumat"));
                jumatContainer.innerHTML = ''; // Hapus loader

                if (querySnapshot.empty) {
                    jumatContainer.innerHTML = `<p class="text-center py-4">Jadwal khotib Jum'at belum tersedia.</p>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const jumat = doc.data();
                    const jumatDate = jumat.tanggal instanceof Timestamp
                        ? jumat.tanggal.toDate().toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })
                        : 'Tanggal tidak valid';

                    const jumatCardHTML = `
                        <div class="bg-white p-4 rounded-lg shadow-sm flex justify-between items-center">
                            <div>
                                <p class="font-semibold">${jumat.khotib}</p>
                                <p class="text-sm text-gray-500">Tema: "${jumat.tema}"</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-green-600">${jumatDate}</p>
                                <p class="text-xs text-gray-400">${jumat.keterangan || ''}</p>
                            </div>
                        </div>
                    `;
                    jumatContainer.innerHTML += jumatCardHTML;
                });
            } catch (error) {
                console.error("Error fetching Friday schedule from Firestore: ", error);
                jumatContainer.innerHTML = `<p class="text-center text-red-500 py-4">Gagal memuat jadwal khotib.</p>`;
            }
        }

        // --- Fungsi untuk mengambil dan menampilkan Pengurus dari Firestore ---
        async function renderPengurus() {
            const pengurusContainer = document.getElementById('pengurus-container');
            const modalContent = document.getElementById('pengurus-modal-content');
            const allPengurusList = []; // Array untuk menyimpan data teks

            if (!pengurusContainer) return;

            try {
                // Mengambil data dari collection 'pengurus' dan diurutkan berdasarkan 'urutan'
                const q = query(collection(db, "pengurus"), orderBy("urutan", "asc"));
                const querySnapshot = await getDocs(q);
                pengurusContainer.innerHTML = ''; // Hapus loader

                if (querySnapshot.empty) {
                    const noDataMsg = `<p class="text-center col-span-1 md:col-span-2 lg:col-span-4">Data pengurus belum tersedia.</p>`;
                    pengurusContainer.innerHTML = noDataMsg;
                    if(modalContent) modalContent.innerHTML = `<p class="text-center">Data pengurus tidak ditemukan.</p>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const pengurus = doc.data();
                    
                    // 1. Simpan data untuk modal teks
                    allPengurusList.push({ nama: pengurus.nama, jabatan: pengurus.jabatan });

                    // 2. Buat Card untuk tampilan utama
                    // Menentukan style untuk jabatan (Ketua akan berwarna hijau)
                    const jabatanClass = pengurus.jabatan.toLowerCase().includes('ketua') 
                                       ? 'text-green-600 font-semibold' 
                                       : 'text-gray-600 font-medium';
                    
                    // Fallback jika fotoUrl tidak ada
                    const fotoUrl = pengurus.fotoUrl || 'https://placehold.co/150x150/e2e8f0/64748b?text=Foto';

                    const pengurusCardHTML = `
                        <div class="bg-white rounded-lg shadow-lg text-center p-6 transition-transform duration-300 hover:scale-105">
                            <img src="${fotoUrl}" alt="Foto ${pengurus.nama}" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-gray-200 object-cover">
                            <h4 class="font-bold text-lg text-gray-800">${pengurus.nama}</h4>
                            <p class="${jabatanClass}">${pengurus.jabatan}</p>
                        </div>
                    `;
                    pengurusContainer.innerHTML += pengurusCardHTML;
                });

                // 3. Isi Modal Pengurus dengan data teks
                if (modalContent) {
                    if (allPengurusList.length > 0) {
                        let modalContentHTML = '';
                        allPengurusList.forEach(p => {
                            modalContentHTML += `
                                <div class="mb-3 pb-3 border-b border-gray-100 last:border-b-0">
                                    <p class="font-semibold text-green-700 text-base">${p.jabatan}</p>
                                    <p class="text-gray-700 text-sm">${p.nama}</p>
                                </div>
                            `;
                        });
                        modalContent.innerHTML = modalContentHTML;
                    } else {
                        // Ini seharusnya tidak terjadi jika querySnapshot tidak empty, tapi sebagai fallback
                        modalContent.innerHTML = '<p class="text-center">Data pengurus tidak ditemukan.</p>';
                    }
                }

            } catch (error) {
                console.error("Error fetching pengurus from Firestore: ", error);
                const errorMsg = `<p class="text-center text-red-500 col-span-1 md:col-span-2 lg:col-span-4">Gagal memuat data pengurus.</p>`;
                pengurusContainer.innerHTML = errorMsg;
                if(modalContent) modalContent.innerHTML = `<p class="text-center text-red-500">Gagal memuat data pengurus.</p>`;
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Jadwal Kegiatan Tabs
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;

                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'text-green-600', 'border-green-600');
                        btn.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });

                    button.classList.add('active', 'text-green-600', 'border-green-600');
                    button.classList.remove('text-gray-500');

                    tabContents.forEach(content => {
                        if (content.id === tabId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // Back to Top Button
            const backToTopButton = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopButton.classList.remove('hidden');
                } else {
                    backToTopButton.classList.add('hidden');
                }
            });
            backToTopButton.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // Active Navigation Link on Scroll
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-link');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.remove('active-nav');
                            if (link.getAttribute('href').substring(1) === entry.target.id) {
                                link.classList.add('active-nav');
                            }
                        });
                    }
                });
            }, { rootMargin: "-50% 0px -50% 0px" });

            sections.forEach(section => {
                observer.observe(section);
            });

            // --- Logika Modal Pengurus ---
            const openModalBtn = document.getElementById('open-pengurus-modal-btn');
            const closeModalBtn = document.getElementById('close-pengurus-modal');
            const modalContainer = document.getElementById('pengurus-modal-container');
            const modalOverlay = document.getElementById('pengurus-modal-overlay');

            if (openModalBtn && closeModalBtn && modalContainer && modalOverlay) {
                openModalBtn.addEventListener('click', () => {
                    modalContainer.classList.remove('hidden'); // Diubah dari 'modal-hidden'
                });

                const closeModal = () => {
                    modalContainer.classList.add('hidden'); // Diubah dari 'modal-hidden'
                };

                closeModalBtn.addEventListener('click', closeModal);
                modalOverlay.addEventListener('click', closeModal);
            }
            // --- Akhir Logika Modal Pengurus ---

            // --- Logika Modal BERITA (BARU) ---
            const beritaContainer = document.getElementById('berita-container');
            const beritaModalContainer = document.getElementById('berita-modal-container');
            const closeBeritaModalBtn = document.getElementById('close-berita-modal');
            const beritaModalOverlay = document.getElementById('berita-modal-overlay');

            if (beritaContainer && beritaModalContainer && closeBeritaModalBtn && beritaModalOverlay) {
                
                // 1. Buka modal (Event Delegation)
                // Kita tambahkan listener ke 'beritaContainer' untuk menangkap klik dari tombol dinamis
                beritaContainer.addEventListener('click', (e) => {
                    const openBtn = e.target.closest('.open-berita-modal-btn');
                    if (openBtn) {
                        const newsId = openBtn.dataset.id;
                        if (newsId) {
                            renderBeritaModal(newsId); // Panggil fungsi render
                            beritaModalContainer.classList.remove('hidden'); // Tampilkan modal
                        }
                    }
                });

                // 2. Tutup modal
                const closeBeritaModal = () => {
                    beritaModalContainer.classList.add('hidden');
                    // Reset konten modal ke loader saat ditutup (untuk persiapan klik berikutnya)
                    document.getElementById('berita-modal-loader').classList.remove('hidden');
                    document.getElementById('berita-modal-content').classList.add('hidden');
                    document.getElementById('berita-modal-title').textContent = 'Judul Berita';
                };

                closeBeritaModalBtn.addEventListener('click', closeBeritaModal);
                beritaModalOverlay.addEventListener('click', closeBeritaModal);
            }
            // --- Akhir Logika Modal Berita ---

            // Fetch Jadwal Shalat API
            function fetchPrayerTimes() {
                // Koordinat untuk Depok, Jawa Barat
                const latitude = -6.397352;
                const longitude = 106.822813;
                const method = 4; // Kemenag
                const today = new Date();
                const year = today.getFullYear();
                const month = today.getMonth() + 1;
                const day = today.getDate();

                const apiUrl = `https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${latitude}&longitude=${longitude}&method=${method}`;
                
                const prayerDateEl = document.getElementById('prayer-date');
                const loader = document.getElementById('prayer-times-loader');
                const container = document.getElementById('prayer-times-container');
                
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Periksa apakah data.data ada dan merupakan array
                        if (data && data.data && Array.isArray(data.data) && data.data.length > day -1) {
                            const todayData = data.data[day - 1];
                            const timings = todayData.timings;
                            const dateReadable = todayData.date.readable;
                            const dateHijri = `${todayData.date.hijri.day} ${todayData.date.hijri.month.en} ${todayData.date.hijri.year}`;
                            
                            prayerDateEl.textContent = `${dateReadable} / ${dateHijri}`;
                            
                            document.getElementById('subuh-time').textContent = timings.Fajr.substring(0, 5);
                            document.getElementById('syuruq-time').textContent = timings.Sunrise.substring(0, 5);
                            document.getElementById('dzuhur-time').textContent = timings.Dhuhr.substring(0, 5);
                            document.getElementById('ashar-time').textContent = timings.Asr.substring(0, 5);
                            document.getElementById('maghrib-time').textContent = timings.Maghrib.substring(0, 5);
                            document.getElementById('isya-time').textContent = timings.Isha.substring(0, 5);

                            loader.classList.add('hidden');
                            container.classList.remove('hidden');
                            container.classList.add('grid');
                        } else {
                             throw new Error('Invalid data structure from API');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching prayer times:', error);
                        prayerDateEl.textContent = 'Gagal memuat jadwal shalat. Coba lagi nanti.';
                        loader.classList.add('hidden');
                    });
            }

            // Panggil fungsi untuk memuat data dari API dan Firebase
            fetchPrayerTimes();
            renderBerita();
            renderJadwalKajian();
            renderJadwalJumat();
            renderPengurus();
        });
    </script>
</body>
</html>

